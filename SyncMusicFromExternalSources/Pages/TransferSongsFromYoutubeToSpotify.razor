@page "/transfersongsfromyoutubetospotify"
@using Google.Apis.YouTube.v3
@using Google.Apis.Services
@using SpotifyApi.NetCore
@inject NavigationManager navMgr
@inject IUsersProfileApi usersApi
@inject IPlaylistsApi playlistsApi
<EditForm Model="@selectedSpotifyPlaylist">
    <div>
        Select Spotify Playlist to transfer songs/tracks to from Youtube playlist(s) ::
        <InputSelect @bind-Value="@selectedSpotifyPlaylist.ID">
            @foreach (UserPlaylist userPlaylist in userPlayLists)
            {
                <option value="@userPlaylist.Id">@userPlaylist.Name</option>
            }
        </InputSelect>
    </div>
</EditForm>
<hr />
<h3>YoutubeListPlaylists</h3>
<table>
    @foreach (MyPlaylist myPlaylist in myPlaylists)
    {
        <tr>
            <td style="vertical-align:top">
                Playlist Title :: @myPlaylist.Title
                <YoutubePlaylist SingleYoutubePlaylist="@myPlaylist" />
            </td>
        </tr>
    }
</table>
@code {
    class SelectedSpotifyPlaylist
    {
        public string ID { get; set; }
    }

    SelectedSpotifyPlaylist selectedSpotifyPlaylist = new SelectedSpotifyPlaylist();

    List<UserPlaylist> userPlayLists = new List<UserPlaylist>();

    List<MyPlaylist> myPlaylists = new List<MyPlaylist>();

    protected override async Task OnInitializedAsync()
    {
        User user = await usersApi.GetCurrentUsersProfile(Startup.SpotifyUserAccessToken);
        PlaylistsSearchResult playlistsSearchResult = await playlistsApi.GetPlaylists(user.Id, Startup.SpotifyUserAccessToken);
        foreach (PlaylistSimplified playlistSimplified in playlistsSearchResult.Items)
        {
            UserPlaylist userPlaylist = new UserPlaylist(playlistSimplified.Name, playlistSimplified.Tracks.Total, playlistSimplified.Id);
            userPlayLists.Add(userPlaylist);
        }

        YouTubeService yts = new YouTubeService(new BaseClientService.Initializer
        {
            ApplicationName = Startup.GoogleApisApplicationName,
            ApiKey = Startup.GoogleApisApiKey
        });
        PlaylistsResource.ListRequest lr = yts.Playlists.List("snippet,contentDetails");
        lr.Mine = true;
        lr.MaxResults = 50;
        lr.AccessToken = Startup.GoogleUserAccessToken;
        IList<Google.Apis.YouTube.v3.Data.Playlist> playlists = (await lr.ExecuteAsync()).Items;
        foreach (Google.Apis.YouTube.v3.Data.Playlist p in playlists)
        {
            MyPlaylist myPlaylist = new MyPlaylist(p.Snippet.Title, p.Id, p.ContentDetails.ItemCount);
            myPlaylists.Add(myPlaylist);
        }

        await base.OnInitializedAsync();
    }

    void DoNothing() { }
}
